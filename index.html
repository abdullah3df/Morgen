<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>صباح الخير — دعاء اليوم</title>
<meta name="theme-color" content="#0b1514"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    /* ألوان صباحية مريحة */
    --bg1:#0b1514; --bg2:#12302b;
    --card:#102926; --edge:#1a3f39;
    --text:#eef8f6; --muted:#a8c9c2;
    --sun1:#ffd56a; --sun2:#ff9f69;
    --btn1:#19c77a; --btn2:#0da261;
    --ringBase:#1a3f39; --ringGrad1:#27e3a1; --ringGrad2:#0fa563;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{
    margin:0;min-height:100dvh;display:grid;place-items:center;
    background:
      radial-gradient(1200px 600px at 10% -10%, #1f5b51 0, transparent 60%),
      radial-gradient(1100px 600px at 110% 0%, #154c45 0, transparent 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--text);font-family:"Cairo",system-ui,-apple-system,"Segoe UI",Arial;
    overflow-x:hidden;
  }
  .wrap{width:min(96vw,920px);padding:22px}
  .card{
    background:linear-gradient(180deg,#11322d,var(--card));
    border:1px solid var(--edge);
    border-radius:26px; padding:26px;
    box-shadow:0 24px 60px rgba(0,0,0,.45);
    text-align:center;
  }
  .screen{display:none;opacity:0;transform:translateY(14px);
    transition:opacity .4s ease, transform .4s ease}
  .screen.show{display:block;opacity:1;transform:none}

  /* شِعار شمس صباحية */
  .logo{width:92px;height:92px;margin:0 auto 10px;border-radius:22px;
    display:grid;place-items:center;position:relative;
    background:linear-gradient(145deg,var(--sun1),var(--sun2));
    box-shadow:0 10px 22px rgba(255,173,87,.35), inset 0 1px 0 rgba(255,255,255,.25)}
  .logo svg{width:52px;height:52px;fill:#5b2d17;opacity:.95}

  h1{margin:4px 0 8px;font-weight:900;font-size:clamp(1.1rem,3.4vw,1.7rem)}
  .muted{color:var(--muted)}
  .bigName{
    font-size:clamp(1.4rem,6vw,3rem);
    font-weight:900; letter-spacing:.5px;
    margin:8px 0 6px;
    background:linear-gradient(90deg,#eafff7,#b4f1e0);
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 1px 0 rgba(255,255,255,.15);
  }
  .today{margin:4px 0 8px;color:var(--muted)}
  .dua{margin:10px auto 12px;line-height:1.85; color:#e9fbf5;
       font-size:clamp(1rem,3vw,1.22rem)}
  .divider{height:1px;background:linear-gradient(90deg,transparent,#2a625a,transparent);margin:14px 0}

  .btn{
    display:inline-grid;place-items:center;grid-auto-flow:column;gap:6px;
    padding:12px 22px;border:none;border-radius:14px;cursor:pointer;
    color:#fff;background:linear-gradient(145deg,var(--btn1),var(--btn2));
    font-weight:900;box-shadow:0 16px 32px rgba(31,214,128,.25), inset 0 1px 0 rgba(255,255,255,.18), inset 0 -6px 14px rgba(0,0,0,.25);
    transition:transform .15s ease, filter .2s ease}
  .btn:hover{filter:brightness(1.03)} .btn:active{transform:translateY(2px)}

  /* الحلقة */
  canvas{width:min(78vw,360px);height:min(78vw,360px);max-width:360px;max-height:360px}
  .ringWrap{display:grid;place-items:center;margin:12px auto}
  .tapHint{margin-top:8px;color:var(--muted)}
  #dhikrText{margin:8px auto 10px;font-weight:700;color:#eafff7;
    font-size:clamp(.9rem,3vw,1.1rem);opacity:.9}

  /* المشاركة */
  .shareArea{margin-top:10px;display:none}
  .shareArea.show{display:block}
  .row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  input[type="text"]{
    width:min(70vw,360px);padding:10px 12px;border-radius:12px;border:1px solid #2a625a;
    background:#0f2c27;color:#dff7f0;outline:none
  }
  .shareBtn{min-width:220px}
  .exitBtn{min-width:160px;background:linear-gradient(145deg,#ff5959,#d93535);
           box-shadow:0 12px 22px rgba(217,53,53,.28), inset 0 1px 0 rgba(255,255,255,.12)}

  /* كونفيتي */
  .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:9999}
  .paper{position:absolute;width:8px;height:14px;border-radius:2px;opacity:.9;animation:fall 3.2s linear forwards}
  @keyframes fall{0%{transform:translateY(-10vh) rotate(0)}100%{transform:translateY(110vh) rotate(760deg)}}
</style>
</head>
<body>

<main class="wrap">
  <!-- شاشة واحدة تجمع المحتوى -->
  <section class="card screen show" id="screen">
    <div class="logo" aria-hidden="true">
      <!-- أيقونة صباح (شمس ونور بسيط) -->
      <svg viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10-9h2V1h-2v3zm7.03 1.21l1.79-1.79-1.79-1.79-1.79 1.79 1.79 1.79zM17 13h3v-2h-3v2zM6.76 19.16l-1.8 1.79 1.79 1.79 1.8-1.79-1.79-1.79zM20 17.24l1.79 1.79 1.79-1.79-1.79-1.79L20 17.24zM11 23h2v-3h-2v3zM12 7a5 5 0 100 10 5 5 0 000-10z"/></svg>
    </div>

    <h1>صباح الخير</h1>

    <div id="nameBlock" class="bigName">ضيف عزيز</div>
    <div id="today" class="today">اليوم — التاريخ</div>

    <div class="divider"></div>

    <div id="dua" class="dua">دعاء اليوم سيظهر هنا…</div>

    <div id="dhikrText">حلقة بسيطة للتفاعل — اكمل الحلقة ثم شارك الدعاء</div>

    <div class="ringWrap">
      <canvas id="ring" width="360" height="360" aria-label="حلقة تفاعلية"></canvas>
      <div class="tapHint">اضغط داخل الحلقة</div>
    </div>

    <div class="shareArea" id="shareArea">
      <div class="row" style="margin-bottom:8px">
        <input id="toInput" type="text" placeholder="اكتب اسم الشخص (مثال: أحمد)"/>
      </div>
      <div class="row">
        <button id="shareBtn" class="btn shareBtn">📤 مشاركة على واتساب</button>
        <button id="exitBtn" class="btn exitBtn">خروج</button>
      </div>
    </div>

    <div id="visitsWrap" class="today" style="margin-top:12px">زوار الصفحة: <b id="visitors">—</b></div>
  </section>
</main>

<div id="confetti" class="confetti"></div>

<script>
(() => {
  "use strict";

  /* === بيانات اليوم والدعاء (7 أدعية) === */
  const DUAS = [
    "اللهم إني أسألك خير هذا اليوم فتحه ونصره ونوره وبركته وهداه.",
    "اللهم بك أصبحنا وبك أمسينا وبك نحيا وبك نموت وإليك المصير.",
    "اللهم اجعل هذا الصباح بداية خير وتيسير لكل أمر عسير.",
    "اللهم ارزقنا في هذا اليوم سعادة لا تزول وصحة لا تحول ورزقًا لا ينقطع.",
    "اللهم إني أسألك العافية في الدنيا والآخرة، اللهم استر عوراتي وآمن روعاتي.",
    "اللهم أعطنا في صباحنا هذا من الخير فوق ما نرجو، واصرف عنا من السوء فوق ما نحذر.",
    "اللهم صلّ على محمد وعلى آله وسلم، وبارك لنا في يومنا هذا."
  ];

  /* === مراجع عناصر === */
  const nameBlock = document.getElementById("nameBlock");
  const todayEl = document.getElementById("today");
  const duaEl = document.getElementById("dua");
  const toInput = document.getElementById("toInput");
  const shareArea = document.getElementById("shareArea");
  const shareBtn = document.getElementById("shareBtn");
  const exitBtn = document.getElementById("exitBtn");
  const visitorsEl = document.getElementById("visitors");
  const confettiLayer = document.getElementById("confetti");

  /* === اسم من الرابط ?to= === */
  const params = new URLSearchParams(location.search);
  const initialName = decodeURIComponent(params.get("to")||"").trim();
  if(initialName){
    nameBlock.textContent = initialName;
    toInput.value = initialName;
  }

  /* === اليوم والتاريخ بالعربية === */
  const now = new Date();
  const weekday = new Intl.DateTimeFormat('ar-EG', { weekday:'long' }).format(now);
  const fullDate = new Intl.DateTimeFormat('ar-EG', { day:'numeric', month:'long', year:'numeric' }).format(now);
  todayEl.textContent = `${weekday} — ${fullDate}`;

  /* === دعاء اليوم بحسب اليوم (0..6) === */
  const dua = DUAS[now.getDay() % DUAS.length];
  duaEl.textContent = dua;

  /* === حلقة الميزان (ضغطات) === */
  const cv = document.getElementById("ring");
  const ctx = cv.getContext("2d");
  const DPR = Math.max(1, window.devicePixelRatio || 1), SIZE=360;
  cv.width = SIZE*DPR; cv.height = SIZE*DPR;

  const TOTAL = 10; // نفس منطق الميزان: 10 ضغطات
  let count = 0;

  function draw(progress){
    const w=cv.width,h=cv.height,r=Math.min(w,h)/2 - 22*DPR;
    ctx.clearRect(0,0,w,h);
    ctx.save(); ctx.translate(w/2,h/2);
    // القاعدة
    ctx.lineWidth=16*DPR; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--ringBase').trim()||"#1a3f39";
    ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.stroke();
    // التقدّم
    const ang=progress*Math.PI*2;
    const gr=ctx.createLinearGradient(-r,0,r,0);
    gr.addColorStop(0,getComputedStyle(document.documentElement).getPropertyValue('--ringGrad1').trim()||"#27e3a1");
    gr.addColorStop(1,getComputedStyle(document.documentElement).getPropertyValue('--ringGrad2').trim()||"#0fa563");
    ctx.strokeStyle=gr; ctx.lineCap="round";
    ctx.beginPath(); ctx.arc(0,0,r,-Math.PI/2,-Math.PI/2+ang); ctx.stroke();
    // وسط الحلقة
    ctx.fillStyle="#eafff7"; ctx.font=(18*DPR)+"px Cairo, system-ui";
    ctx.textAlign="center"; ctx.fillText("اضغط هنا",0,8*DPR);
    ctx.restore();
  }
  draw(0);

  function beep(){
    try{
      if(!window._ac) window._ac=new (window.AudioContext||window.webkitAudioContext)();
      const ac=window._ac,o=ac.createOscillator(),g=ac.createGain();
      o.type='sine'; o.frequency.value=720; g.gain.value=.06;
      o.connect(g).connect(ac.destination);
      const t=ac.currentTime; o.start(t);
      g.gain.exponentialRampToValueAtTime(0.0001,t+.09); o.stop(t+.11);
    }catch{}
  }

  function runConfetti(amount=140, duration=1800){
    confettiLayer.innerHTML=""; confettiLayer.style.display="block";
    const colors=["#e1ffea","#b2f5dc","#8ee6ca","#68dab8","#fff176","#ffd54f"];
    const W=innerWidth,H=innerHeight;
    for(let i=0;i<amount;i++){
      const p=document.createElement("div");
      p.className="paper";
      p.style.left=(Math.random()*W)+"px";
      p.style.top=(-20-Math.random()*H*0.3)+"px";
      p.style.background=colors[(Math.random()*colors.length)|0];
      p.style.animationDelay=(Math.random()*0.8)+"s";
      p.style.transform=`translateY(-10vh) rotate(${Math.random()*360}deg)`;
      confettiLayer.appendChild(p);
    }
    setTimeout(()=>{confettiLayer.style.display='none';confettiLayer.innerHTML="";}, duration);
  }

  cv.addEventListener("click", ()=>{
    if(count>=TOTAL) return;
    if(navigator.vibrate) navigator.vibrate(15);
    beep();
    count++;
    draw(count/TOTAL);

    // مؤثرات كل 5 لمسات خفيفة، وعند الإكمال احتفال أكبر
    if(count % 5 === 0 && count < TOTAL) runConfetti(90, 1600);
    if(count === TOTAL){
      runConfetti(200, 3200);
      shareArea.classList.add('show'); // إظهار المشاركة بعد الإكمال
    }
  });

  /* === مشاركة واتساب بالرابط + الاسم === */
  function currentName(){
    const n = toInput.value.trim() || nameBlock.textContent.trim();
    return n || "صديقي";
  }

  // نص المشاركة: صباح الخير + اسم + دعاء + رابط مع اسم
  function buildShare(){
    const name = currentName();
    const baseLink = location.origin + location.pathname + "?to=" + encodeURIComponent(name);
    const text =
      `صباح الخير يا ${name} 🌅\n` +
      `دعاء اليوم (${weekday}، ${fullDate}):\n` +
      `“${dua}”\n` +
      baseLink;
    return "https://wa.me/?text=" + encodeURIComponent(text);
  }

  // تحديث الاسم الكبير تلقائيًا
  toInput.addEventListener('input', ()=>{
    const n = toInput.value.trim();
    if(n) nameBlock.textContent = n;
  });

  shareBtn.addEventListener("click", ()=> {
    window.open(buildShare(), "_blank", "noopener");
  });
  exitBtn.addEventListener("click", ()=> {
    // نفس المشاركة أيضًا (كما طلبت)
    window.open(buildShare(), "_blank", "noopener");
  });

  /* === عدّاد زوار بسيط === */
  (async function updateVisitors(){
    try{
      const ns="gm-dua-daily"; const key="visitors";
      const r = await fetch(`https://api.countapi.xyz/hit/${ns}/${key}`, {cache:"no-store"});
      const d = await r.json();
      visitorsEl.textContent = (typeof d.value==='number') ? d.value.toLocaleString('ar-EG') : "—";
    }catch(e){
      const k="local-v"; const v=(parseInt(localStorage.getItem(k)||"0",10)+1);
      localStorage.setItem(k,String(v));
      visitorsEl.textContent = v.toLocaleString('ar-EG');
    }
  })();

})();
</script>
</body>
</html>
